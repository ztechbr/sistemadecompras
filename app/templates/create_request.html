{% extends "base.html" %}
{% block title %}Nova Requisição{% endblock %}
{% block content %}
<div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900"><i class="fas fa-plus-circle mr-2"></i>Nova Requisição de Compra</h1>
    <p class="text-gray-600 mt-2">Preencha os dados para solicitar uma compra</p>
</div>
<div class="max-w-2xl">
    <form method="POST" action="{{ url_for('user.create_request') }}" class="bg-white rounded-lg shadow p-6">
        <div class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-box mr-2"></i>Produto</label>
                <select name="product_id" id="product_id" required class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" onchange="updatePrice()">
                    <option value="">Selecione um produto...</option>
                    {% for product in products %}
                    <option value="{{ product.id }}" data-price="{{ product.average_unit_value }}">{{ product.sku }} - {{ product.product_name }} ({{ product.average_unit_value|format_currency }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-sort-numeric-up mr-2"></i>Quantidade</label>
                <input type="number" name="quantity" id="quantity" min="1" required class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" onchange="updatePrice()">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-dollar-sign mr-2"></i>Valor Estimado</label>
                <input type="text" id="estimated_total" readonly class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-100" value="R$ 0,00">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-comment mr-2"></i>Observações</label>
                <textarea name="notes" rows="4" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Informações adicionais sobre a requisição..."></textarea>
            </div>
        </div>
        <div class="mt-6 flex justify-end space-x-3">
            <a href="{{ url_for('user.dashboard') }}" class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50">Cancelar</a>
            <button type="submit" class="bg-blue-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-blue-700"><i class="fas fa-check mr-2"></i>Criar Requisição</button>
        </div>
    </form>
</div>
{% endblock %}
{% block scripts %}
<script>
function updatePrice(){const sel=document.getElementById('product_id');const qty=document.getElementById('quantity').value||0;const price=sel.options[sel.selectedIndex]?.dataset.price||0;const total=parseFloat(price)*parseInt(qty);document.getElementById('estimated_total').value='R$ '+total.toFixed(2).replace('.',',').replace(/\B(?=(\d{3})+(?!\d))/g,'.');}
</script>
{% endblock %}

